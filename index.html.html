<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Smart Kids Menu ‚Äì Balanced Meal Game</title>
  <style>
    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      font-family: "Poppins", Arial, sans-serif;
      background: linear-gradient(135deg, #f7fbff, #fdf3ff);
      color: #222;
      /* NEW: slow animated background */
      background-size: 200% 200%;
      animation: bgMove 18s ease-in-out infinite;
    }

    @keyframes bgMove {
      0% { background-position: 0% 0%; }
      50% { background-position: 100% 50%; }
      100% { background-position: 0% 100%; }
    }

    header {
      background: linear-gradient(135deg, #ffb347, #ffcc33);
      padding: 18px 16px 14px;
      text-align: center;
      box-shadow: 0 2px 8px rgba(0,0,0,0.2);
      position: sticky;
      top: 0;
      z-index: 10;
    }

    header h1 {
      margin: 0;
      font-size: 2rem;
      /* NEW: playful floating animation */
      animation: floatTitle 3.5s ease-in-out infinite;
    }

    @keyframes floatTitle {
      0% { transform: translateY(0); }
      50% { transform: translateY(-4px) scale(1.02); }
      100% { transform: translateY(0); }
    }

    header p {
      margin: 4px 0 0;
      font-size: 0.95rem;
    }

    .points-bar {
      margin-top: 8px;
      display: inline-flex;
      flex-direction: column;
      align-items: center;
      gap: 6px;
      padding: 6px 12px;
      border-radius: 14px;
      background: rgba(255,255,255,0.9);
      font-size: 0.9rem;
      box-shadow: 0 2px 6px rgba(0,0,0,0.15);
    }

    .points-line {
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .points-value {
      font-weight: 700;
      padding: 4px 10px;
      border-radius: 999px;
      background: #4caf50;
      color: white;
      min-width: 40px;
      text-align: center;
      display: inline-block;
    }

    .points-value.pop {
      animation: pop 0.5s ease;
    }

    @keyframes pop {
      0% { transform: scale(1); }
      40% { transform: scale(1.25); }
      100% { transform: scale(1); }
    }

    .progress-wrapper {
      width: 220px;
      font-size: 0.8rem;
    }

    .progress-label {
      margin-bottom: 2px;
    }

    .progress-bar {
      width: 100%;
      height: 8px;
      border-radius: 999px;
      background: #ffe9b5;
      overflow: hidden;
    }

    .progress-fill {
      height: 100%;
      width: 0%;
      background: linear-gradient(90deg, #4caf50, #8fdc6f);
      border-radius: 999px;
      transition: width 0.3s ease;
    }

    main {
      max-width: 1150px;
      margin: 0 auto;
      padding: 16px;
      /* NEW: fade-in for main content */
      animation: pageFadeIn 0.7s ease-out;
    }

    @keyframes pageFadeIn {
      from {
        opacity: 0;
        transform: translateY(12px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .intro-card {
      background: rgba(255,255,255,0.95);
      border-radius: 16px;
      padding: 12px 16px;
      border-left: 5px solid #ffb347;
      font-size: 0.95rem;
      margin-bottom: 12px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.12);
    }

    .layout {
      display: grid;
      grid-template-columns: 1.2fr 1.1fr;
      gap: 16px;
      align-items: flex-start;
    }

    @media (max-width: 900px) {
      .layout {
        grid-template-columns: 1fr;
      }
    }

    .panel {
      background: rgba(255,255,255,0.96);
      border-radius: 18px;
      padding: 16px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.12);
      /* NEW: subtle entrance animation */
      animation: panelIn 0.6s ease-out;
    }

    @keyframes panelIn {
      from {
        opacity: 0;
        transform: translateY(10px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .panel h2 {
      margin-top: 0;
      font-size: 1.1rem;
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .meal-tabs {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-bottom: 10px;
    }

    .meal-tab {
      border-radius: 999px;
      border: none;
      padding: 6px 12px;
      cursor: pointer;
      font-size: 0.9rem;
      display: inline-flex;
      align-items: center;
      gap: 4px;
      background: #f1f5ff;
      color: #333;
      box-shadow: 0 1px 3px rgba(0,0,0,0.15);
      transition: background 0.15s, transform 0.1s, box-shadow 0.15s;
    }

    .meal-tab.active {
      background: #4f8cff;
      color: #fff;
      transform: translateY(-1px);
      box-shadow: 0 3px 8px rgba(79,140,255,0.45);
    }

    .meal-tab:hover {
      transform: translateY(-2px) scale(1.02);
      box-shadow: 0 3px 10px rgba(79,140,255,0.5);
    }

    .meal-tab:active {
      transform: translateY(1px) scale(0.98);
      box-shadow: 0 1px 3px rgba(0,0,0,0.2);
    }

    .category-block {
      margin-bottom: 8px;
    }

    .category-block h3 {
      margin: 8px 0 4px;
      font-size: 0.9rem;
    }

    .chips-group {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
    }

    .chip {
      display: inline-flex;
      align-items: center;
      gap: 5px;
      padding: 6px 10px;
      border-radius: 999px;
      border: 1px solid #c8d8ff;
      background: #f0f4ff;
      font-size: 0.8rem;
      cursor: pointer;
      transition: transform 0.15s, box-shadow 0.15s, background 0.15s, border-color 0.15s;
      user-select: none;
    }

    .chip span.emoji {
      font-size: 1rem;
      /* NEW: tiny bounce on hover via parent */
      transition: transform 0.15s;
    }

    .chip:hover {
      transform: translateY(-2px) scale(1.05);
      box-shadow: 0 3px 10px rgba(0,0,0,0.16);
    }

    .chip:hover .emoji {
      transform: rotate(-4deg) scale(1.1);
    }

    .chip.selected {
      background: #ff7eb3;
      color: white;
      border-color: #ff5790;
      box-shadow: 0 2px 6px rgba(255,126,179,0.5);
      transform: translateY(-1px) scale(1.04);
    }

    .chip input {
      display: none;
    }

    .buttons-row {
      margin-top: 10px;
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
    }

    button {
      font-family: inherit;
    }

    .btn {
      border: none;
      border-radius: 999px;
      padding: 8px 14px;
      font-size: 0.9rem;
      cursor: pointer;
      font-weight: 600;
      box-shadow: 0 2px 6px rgba(0,0,0,0.15);
      transition: transform 0.15s, box-shadow 0.15s, filter 0.15s;
    }

    .btn-primary {
      background: #4caf50;
      color: white;
    }

    .btn-secondary {
      background: #ffffff;
      color: #333;
      border: 1px solid #cbd5f5;
    }

    .btn-info {
      background: #4f8cff;
      color: #fff;
    }

    .btn:hover {
      transform: translateY(-2px) scale(1.03);
      box-shadow: 0 3px 10px rgba(0,0,0,0.2);
      filter: brightness(1.05);
    }

    .btn:active {
      transform: translateY(1px) scale(0.97);
      box-shadow: 0 1px 3px rgba(0,0,0,0.2);
      filter: brightness(0.95);
    }

    .cuisine-row {
      margin-top: 8px;
      font-size: 0.9rem;
      display: flex;
      align-items: center;
      gap: 8px;
      flex-wrap: wrap;
    }

    select {
      padding: 6px 10px;
      border-radius: 8px;
      border: 1px solid #c8d8ff;
      font-size: 0.9rem;
      transition: box-shadow 0.15s, transform 0.15s;
    }

    select:focus {
      outline: none;
      box-shadow: 0 0 0 3px rgba(79,140,255,0.3);
      transform: translateY(-1px);
    }

    .feedback-box {
      margin-top: 10px;
      padding: 8px 10px;
      border-radius: 10px;
      font-size: 0.85rem;
      background: #fffcec;
      border: 1px solid #ffe08a;
      animation: feedbackIn 0.3s ease-out;
    }

    @keyframes feedbackIn {
      from {
        opacity: 0;
        transform: translateY(6px) scale(0.98);
      }
      to {
        opacity: 1;
        transform: translateY(0) scale(1);
      }
    }

    .feedback-box.good {
      background: #e6ffec;
      border-color: #7bd98b;
      box-shadow: 0 0 0 2px rgba(52,199,89,0.15);
    }

    .feedback-box.bad {
      background: #fff0f0;
      border-color: #ff8a8a;
      box-shadow: 0 0 0 2px rgba(255,138,138,0.15);
    }

    /* Right panel: recipes & day summary */

    .recipes-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 6px;
      margin-bottom: 6px;
    }

    .recipes-header small {
      font-size: 0.8rem;
      color: #555;
    }

    .recipes-container {
      max-height: 55vh;
      overflow-y: auto;
      padding-right: 4px;
    }

    .recipe-card {
      background: #ffffff;
      border-radius: 16px;
      padding: 10px 12px;
      margin-bottom: 10px;
      border: 1px solid #e0e7ff;
      font-size: 0.85rem;
      animation: fadeInUp 0.35s ease;
    }

    @keyframes fadeInUp {
      from {
        opacity: 0;
        transform: translateY(8px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .recipe-title-row {
      display: flex;
      justify-content: space-between;
      align-items: baseline;
      gap: 8px;
    }

    .recipe-title-row h3 {
      margin: 0;
      font-size: 0.95rem;
    }

    .cuisine-tag {
      font-size: 0.7rem;
      padding: 2px 8px;
      border-radius: 999px;
      border: 1px solid #ffd27f;
      background: #fff6df;
      white-space: nowrap;
    }

    .recipe-tags {
      font-size: 0.75rem;
      margin: 4px 0;
      color: #555;
    }

    .recipe-tags span {
      display: inline-block;
      margin-right: 4px;
      margin-bottom: 3px;
      padding: 2px 6px;
      border-radius: 999px;
      background: #f1f5f9;
    }

    .recipe-section-title {
      font-weight: 600;
      margin-top: 4px;
    }

    ul, ol {
      margin: 4px 0 4px 20px;
      padding-left: 16px;
    }

    .recipe-footer {
      font-size: 0.78rem;
      margin-top: 4px;
      color: #555;
    }

    .empty-state {
      text-align: center;
      font-size: 0.88rem;
      color: #666;
      padding: 20px 8px;
    }

    .empty-state strong {
      display: block;
      margin-bottom: 4px;
      font-size: 0.95rem;
    }

    .day-summary {
      margin-top: 10px;
      padding-top: 8px;
      border-top: 1px dashed #d0d7ff;
      font-size: 0.8rem;
    }

    .day-summary h3 {
      margin: 0 0 4px;
      font-size: 0.9rem;
    }

    .day-summary ul {
      margin: 0;
      padding-left: 18px;
    }

    .badge {
      display: inline-block;
      padding: 2px 8px;
      border-radius: 999px;
      font-size: 0.75rem;
      background: #e7f5ff;
      margin-left: 4px;
    }

    /* Did you know box */
    .did-you-know {
      margin-top: 10px;
      padding: 10px 12px;
      border-radius: 14px;
      background: #e6f4ff;
      border: 1px solid #b3d4ff;
      font-size: 0.82rem;
      display: flex;
      flex-direction: column;
      gap: 6px;
      animation: fadeInUp 0.3s ease;
    }

    .did-you-know-title {
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: 4px;
    }

    .did-you-know-text {
      font-size: 0.8rem;
    }

    .did-you-know .btn {
      align-self: flex-start;
      font-size: 0.8rem;
      padding: 6px 10px;
    }
  </style>
</head>
<body>
  <header>
    <h1>ü•ó Smart Kids Menu</h1>
    <p>Build your own breakfast, lunch and dinner ‚Äì and earn points for balanced meals!</p>
    <div class="points-bar">
      <div class="points-line">
        <span>‚≠ê Your health points today:</span>
        <span class="points-value" id="pointsValue">0</span>
      </div>
      <div class="progress-wrapper">
        <div class="progress-label" id="progressLabel">Balanced meals today: 0 of 3</div>
        <div class="progress-bar">
          <div class="progress-fill" id="progressFill"></div>
        </div>
      </div>
    </div>
  </header>

  <main>
    <div class="intro-card">
      <strong>How to play:</strong><br>
      1Ô∏è‚É£ Choose a meal (Breakfast, Lunch or Dinner).<br>
      2Ô∏è‚É£ Tap your favourite fruits, veggies, proteins and carbs.<br>
      3Ô∏è‚É£ Choose a cuisine and press <b>‚ÄúShow Recipes‚Äù</b> to see dishes you can make.<br>
      4Ô∏è‚É£ Press <b>‚ÄúCheck Balance‚Äù</b>. If your meal has fruit + veg + protein + carbs, you earn ‚≠ê points!
    </div>

    <div class="layout">
      <!-- LEFT: Food choices -->
      <section class="panel">
        <h2>Step 1: Choose your foods üçΩÔ∏è</h2>

        <div class="meal-tabs">
          <button class="meal-tab active" data-meal="breakfast">üç≥ Breakfast</button>
          <button class="meal-tab" data-meal="lunch">üçõ Lunch</button>
          <button class="meal-tab" data-meal="dinner">üçΩÔ∏è Dinner</button>
        </div>

        <div id="currentMealLabel" style="font-size:0.85rem; margin-bottom:6px;">
          You are choosing foods for <strong>Breakfast</strong>.
        </div>

        <div id="chipsArea">
          <!-- Chips will be injected here by JavaScript -->
        </div>

        <div class="cuisine-row">
          <span>Choose cuisine:</span>
          <select id="cuisineSelect">
            <option value="any">Any cuisine</option>
            <option value="Indian">Indian</option>
            <option value="Continental">Continental</option>
            <option value="Global">Global / Simple</option>
          </select>
        </div>

        <div class="buttons-row">
          <button class="btn btn-primary" id="showRecipesBtn">Show Recipes for this Meal</button>
          <button class="btn btn-info" id="checkBalanceBtn">Check Balance for this Meal</button>
          <button class="btn btn-secondary" id="clearMealBtn">Clear This Meal</button>
        </div>

        <div id="mealFeedback" class="feedback-box" style="display:none;"></div>
      </section>

      <!-- RIGHT: Recipes + Day summary + Did you know -->
      <section class="panel">
        <div class="recipes-header">
          <h2>Step 2: Your recipe ideas üë©‚Äçüç≥üë®‚Äçüç≥</h2>
          <small id="recipeCountLabel">No recipes yet</small>
        </div>
        <div class="recipes-container" id="recipesContainer">
          <div class="empty-state">
            <strong>Ready to cook in your mind?</strong>
            First choose foods on the left, then press ‚ÄúShow Recipes‚Äù.
          </div>
        </div>

        <div class="day-summary">
          <h3>Step 3: Day summary üß†</h3>
          <p style="margin:0 0 4px;">Check if all your meals are balanced:</p>
          <button class="btn btn-secondary" id="checkDayBtn">Check My Whole Day</button>
          <ul id="daySummaryList"></ul>
          <p style="margin-top:4px; font-size:0.78rem; color:#666;">
            Tip: A balanced meal usually has <b>fruit</b>, <b>vegetables</b>, <b>protein</b> and <b>carbs</b>.
          </p>
        </div>

        <div class="did-you-know" id="didYouKnowBox">
          <div class="did-you-know-title">üí° Did you know?</div>
          <div class="did-you-know-text" id="didYouKnowText">
            Eating different colours of fruits and vegetables helps your body in many different ways.
          </div>
          <button class="btn btn-secondary" id="newFactBtn">New Fact</button>
        </div>
      </section>
    </div>
  </main>

  <script>
    // -----------------------------
    // Data: food options
    // -----------------------------
    const foodOptions = {
      fruit: [
        { id: "apple", label: "Apple", emoji: "üçé" },
        { id: "banana", label: "Banana", emoji: "üçå" },
        { id: "mango", label: "Mango", emoji: "ü•≠" },
        { id: "orange", label: "Orange", emoji: "üçä" },
        { id: "grapes", label: "Grapes", emoji: "üçá" },
        { id: "watermelon", label: "Watermelon", emoji: "üçâ" },
        { id: "strawberry", label: "Strawberry", emoji: "üçì" },
        { id: "papaya", label: "Papaya", emoji: "ü•≠" }
      ],
      veg: [
        { id: "carrot", label: "Carrot", emoji: "ü•ï" },
        { id: "cucumber", label: "Cucumber", emoji: "ü•í" },
        { id: "tomato", label: "Tomato", emoji: "üçÖ" },
        { id: "spinach", label: "Spinach", emoji: "ü•¨" },
        { id: "broccoli", label: "Broccoli", emoji: "ü•¶" },
        { id: "peas", label: "Peas", emoji: "üü¢" },
        { id: "corn", label: "Corn", emoji: "üåΩ" },
        { id: "capsicum", label: "Capsicum", emoji: "ü´ë" }
      ],
      protein: [
        { id: "egg", label: "Egg", emoji: "ü•ö" },
        { id: "chicken", label: "Chicken", emoji: "üçó" },
        { id: "paneer", label: "Paneer", emoji: "üßÄ" },
        { id: "lentils", label: "Lentils", emoji: "üç≤" },
        { id: "chickpeas", label: "Chickpeas", emoji: "üßÜ" },
        { id: "tofu", label: "Tofu", emoji: "üç±" },
        { id: "fish", label: "Fish", emoji: "üêü" },
        { id: "yogurt", label: "Yogurt", emoji: "ü•õ" }
      ],
      carb: [
        { id: "rice", label: "Rice", emoji: "üçö" },
        { id: "roti", label: "Roti / Chapati", emoji: "ü´ì" },
        { id: "bread", label: "Bread", emoji: "üçû" },
        { id: "pasta", label: "Pasta", emoji: "üçù" },
        { id: "idli", label: "Idli", emoji: "ü•ò" },
        { id: "dosa", label: "Dosa", emoji: "ü•û" },
        { id: "oats", label: "Oats", emoji: "ü•£" },
        { id: "poha", label: "Poha", emoji: "üçõ" }
      ],
      extra: [
        { id: "nuts", label: "Nuts", emoji: "ü•ú" },
        { id: "milk", label: "Milk", emoji: "ü•õ" },
        { id: "cheese", label: "Cheese", emoji: "üßÄ" },
        { id: "saladLeaves", label: "Salad leaves", emoji: "ü•ó" },
        { id: "honey", label: "Honey", emoji: "üçØ" }
      ]
    };

    const KEY_GROUPS = ["fruit", "veg", "protein", "carb"];

    // Meals: breakfast, lunch, dinner
    const meals = ["breakfast", "lunch", "dinner"];

    // Store selections for each meal
    const selections = {};
    const balanceAwarded = {};
    meals.forEach(m => {
      selections[m] = {
        fruit: new Set(),
        veg: new Set(),
        protein: new Set(),
        carb: new Set(),
        extra: new Set()
      };
      balanceAwarded[m] = false;
    });

    let currentMeal = "breakfast";
    let points = 0;

    // -----------------------------
    // Data: recipes (with steps)
    // -----------------------------
    const recipes = [
      {
        name: "Sunny Fruit & Yogurt Bowl",
        cuisine: "Global",
        meals: ["breakfast"],
        tags: ["banana","apple","grapes","yogurt","oats","honey","nuts"],
        ingredients: [
          "1 small banana (sliced)",
          "1/2 apple (chopped)",
          "A small handful of grapes",
          "3 spoons of plain yogurt",
          "2 spoons of dry oats",
          "1 teaspoon honey (optional)",
          "Some crushed nuts (optional)"
        ],
        steps: [
          "Put the yogurt into a bowl.",
          "Add the oats and mix gently.",
          "Place the sliced banana, apple pieces and grapes on top.",
          "Drizzle a little honey if you like it sweeter.",
          "Sprinkle some crushed nuts for crunch.",
          "Enjoy with a spoon ‚Äì perfect for breakfast!"
        ],
        healthNote: "Gives you energy, vitamins, protein and fibre to start the day."
      },
      {
        name: "Indian Veggie Upma / Poha Bowl",
        cuisine: "Indian",
        meals: ["breakfast"],
        tags: ["poha","carrot","peas","corn","capsicum"],
        ingredients: [
          "1 cup poha (flattened rice) or cooked upma",
          "1 small carrot (chopped small)",
          "A small handful of peas and corn",
          "Some chopped capsicum",
          "1 teaspoon oil, salt and mild spices"
        ],
        steps: [
          "Wash poha quickly in water and drain, or use cooked upma.",
          "In a pan, heat a little oil and add vegetables.",
          "Cook the vegetables until they turn soft.",
          "Add poha / upma and mix well with a little salt.",
          "Cook for 2‚Äì3 minutes on low flame.",
          "Serve warm in a bowl."
        ],
        healthNote: "Carbs for energy plus colourful vegetables for vitamins."
      },
      {
        name: "Rainbow Veg Sandwich",
        cuisine: "Continental",
        meals: ["breakfast","lunch"],
        tags: ["bread","cheese","cucumber","tomato","carrot","saladLeaves"],
        ingredients: [
          "2 slices of brown or white bread",
          "1 slice of cheese or grated cheese",
          "Sliced cucumber",
          "Sliced tomato",
          "Grated carrot",
          "Some salad leaves",
          "A little butter or spread"
        ],
        steps: [
          "Spread a little butter or spread on the bread slices.",
          "Place cheese on one slice.",
          "Add layers of cucumber, tomato, carrot and salad leaves.",
          "Close with the second bread slice.",
          "Cut the sandwich into 2‚Äì4 small triangles.",
          "Enjoy as a colourful, crunchy sandwich."
        ],
        healthNote: "Has carbs from bread, protein from cheese and vitamins from veggies."
      },
      {
        name: "Paneer Veggie Wrap",
        cuisine: "Continental",
        meals: ["lunch","dinner"],
        tags: ["paneer","capsicum","carrot","cucumber","roti","saladLeaves"],
        ingredients: [
          "1 roti or tortilla",
          "Small cubes of paneer (lightly cooked or grilled)",
          "Thinly sliced capsicum and carrot",
          "Some cucumber slices",
          "A few salad leaves",
          "A little yogurt or light sauce"
        ],
        steps: [
          "Place the roti or tortilla on a plate.",
          "Put paneer cubes in the centre.",
          "Add capsicum, carrot, cucumber and salad leaves on top.",
          "Drizzle a spoon of yogurt or light sauce.",
          "Roll it gently to make a wrap.",
          "Cut into two pieces and serve."
        ],
        healthNote: "Good mix of carbs, protein and vegetables ‚Äì fun to eat and hold."
      },
      {
        name: "Simple Lentil Rice Bowl",
        cuisine: "Indian",
        meals: ["lunch","dinner"],
        tags: ["rice","lentils","spinach","carrot"],
        ingredients: [
          "1 small bowl of cooked rice",
          "1 small bowl of cooked lentil dal",
          "A handful of chopped spinach",
          "Some chopped carrot",
          "Mild spices and salt"
        ],
        steps: [
          "Cook lentils with water until soft (with adult help).",
          "In a pan, cook chopped carrot and spinach for a few minutes.",
          "Mix the vegetables into the lentil dal.",
          "Place warm rice in a bowl.",
          "Pour the vegetable dal on top of the rice.",
          "Eat with a spoon ‚Äì it is soft and easy to digest."
        ],
        healthNote: "Lentils give protein, rice gives energy, veggies give vitamins."
      },
      {
        name: "Chicken & Veg Rice Bowl",
        cuisine: "Indian",
        meals: ["lunch","dinner"],
        tags: ["chicken","rice","carrot","peas","corn"],
        ingredients: [
          "1 small bowl of cooked rice",
          "Small cooked pieces of chicken (boneless)",
          "Chopped carrot, peas and corn",
          "Mild spices and a little oil"
        ],
        steps: [
          "With an adult, cook small chicken pieces in a pan with mild spices.",
          "Add chopped carrot, peas and corn and cook until soft.",
          "Mix this chicken and veggie mixture with the rice.",
          "Serve warm in a bowl.",
          "Enjoy with a spoon or fork."
        ],
        healthNote: "Protein from chicken and veggies with rice makes a full meal."
      },
      {
        name: "Veggie Dosa / Idli Plate",
        cuisine: "Indian",
        meals: ["breakfast","dinner"],
        tags: ["dosa","idli","sambar","carrot","tomato"],
        ingredients: [
          "2 small idlis or 1 dosa",
          "Vegetable sambar made with carrot and tomato",
          "Little coconut chutney (optional)"
        ],
        steps: [
          "With an adult, prepare idlis or dosa batter or use ready batter.",
          "Cook the idlis or dosa on a hot pan/steamer.",
          "Serve with warm vegetable sambar containing carrot and tomato.",
          "Add a spoon of chutney if you like.",
          "Eat by dipping idli / dosa in sambar."
        ],
        healthNote: "Fermented rice/lentil batter plus veggies is light but filling."
      },
      {
        name: "Colourful Pasta Bowl",
        cuisine: "Continental",
        meals: ["lunch","dinner"],
        tags: ["pasta","carrot","peas","corn","cheese","broccoli"],
        ingredients: [
          "1 small bowl of cooked pasta",
          "Chopped carrot, peas, corn and broccoli",
          "A little grated cheese",
          "Olive oil or a tiny bit of butter",
          "A pinch of salt and herbs"
        ],
        steps: [
          "Boil pasta in water until soft (adult help needed).",
          "In a pan, cook the vegetables in a little oil or butter.",
          "Mix the cooked pasta with the vegetables.",
          "Sprinkle cheese on top and mix until it melts slightly.",
          "Serve warm in a bowl."
        ],
        healthNote: "Carbs from pasta + veggies + some protein from cheese."
      },
      {
        name: "Fruit & Nut Energy Snack",
        cuisine: "Global",
        meals: ["breakfast","snack"],
        tags: ["apple","banana","nuts","milk"],
        ingredients: [
          "Slices of apple and banana",
          "A small handful of mixed nuts",
          "A small glass of milk"
        ],
        steps: [
          "Arrange apple and banana slices on a small plate.",
          "Place the nuts in the centre.",
          "Drink milk along with the fruits and nuts.",
          "Chew slowly and enjoy the different textures."
        ],
        healthNote: "Good as a mini-meal: protein, healthy fats and vitamins."
      }
    ];

    // Nutrition facts for "Did you know?"
    const nutritionFacts = [
      "Eating different colours of fruits and vegetables helps your body in many different ways.",
      "Protein foods like lentils, paneer, eggs and chicken help to build strong muscles.",
      "Carbs like rice, roti, bread and pasta give you energy to play and learn.",
      "Drinking enough water is also part of healthy eating.",
      "Breakfast helps you think better in school because it gives your brain fuel.",
      "Fruits are a sweet snack that is much healthier than most candies.",
      "Vegetables give you vitamins that protect your eyes, skin and body.",
      "Yogurt has good bacteria that help your tummy stay happy."
    ];

    // -----------------------------
    // DOM references
    // -----------------------------
    const chipsArea = document.getElementById("chipsArea");
    const mealTabs = document.querySelectorAll(".meal-tab");
    const currentMealLabel = document.getElementById("currentMealLabel");
    const cuisineSelect = document.getElementById("cuisineSelect");
    const showRecipesBtn = document.getElementById("showRecipesBtn");
    const checkBalanceBtn = document.getElementById("checkBalanceBtn");
    const clearMealBtn = document.getElementById("clearMealBtn");
    const mealFeedbackBox = document.getElementById("mealFeedback");
    const recipesContainer = document.getElementById("recipesContainer");
    const recipeCountLabel = document.getElementById("recipeCountLabel");
    const pointsValue = document.getElementById("pointsValue");
    const checkDayBtn = document.getElementById("checkDayBtn");
    const daySummaryList = document.getElementById("daySummaryList");
    const progressFill = document.getElementById("progressFill");
    const progressLabel = document.getElementById("progressLabel");
    const didYouKnowText = document.getElementById("didYouKnowText");
    const newFactBtn = document.getElementById("newFactBtn");

    // -----------------------------
    // Rendering chips
    // -----------------------------
    function renderChips() {
      chipsArea.innerHTML = "";

      for (const [category, items] of Object.entries(foodOptions)) {
        const block = document.createElement("div");
        block.className = "category-block";

        const niceName = {
          fruit: "Fruits üçé",
          veg: "Vegetables ü•¶",
          protein: "Proteins üí™",
          carb: "Carbs / Grains üçö",
          extra: "Extras üßÅ"
        }[category] || category;

        block.innerHTML = `<h3>${niceName}</h3>`;
        const group = document.createElement("div");
        group.className = "chips-group";

        items.forEach(item => {
          const label = document.createElement("label");
          label.className = "chip";
          label.dataset.category = category;
          label.dataset.id = item.id;
          label.innerHTML = `
            <input type="checkbox" value="${item.id}">
            <span class="emoji">${item.emoji}</span>
            <span>${item.label}</span>
          `;
          // Click handler
          label.addEventListener("click", (e) => {
            e.preventDefault();
            toggleSelection(label.dataset.category, label.dataset.id, label);
          });
          group.appendChild(label);
        });

        block.appendChild(group);
        chipsArea.appendChild(block);
      }

      // After building chips, align selection with currentMeal
      updateChipSelectionFromState();
    }

    function toggleSelection(category, id, chipElement) {
      const set = selections[currentMeal][category];
      if (set.has(id)) {
        set.delete(id);
        chipElement.classList.remove("selected");
      } else {
        set.add(id);
        chipElement.classList.add("selected");
      }
    }

    function updateChipSelectionFromState() {
      const current = selections[currentMeal];
      document.querySelectorAll(".chip").forEach(chip => {
        const cat = chip.dataset.category;
        const id = chip.dataset.id;
        if (current[cat] && current[cat].has(id)) {
          chip.classList.add("selected");
        } else {
          chip.classList.remove("selected");
        }
      });
    }

    // -----------------------------
    // Meal switching
    // -----------------------------
    mealTabs.forEach(tab => {
      tab.addEventListener("click", () => {
        const meal = tab.dataset.meal;
        if (meal === currentMeal) return;

        currentMeal = meal;
        mealTabs.forEach(t => t.classList.toggle("active", t === tab));
        currentMealLabel.innerHTML = `You are choosing foods for <strong>${capitalize(meal)}</strong>.`;
        mealFeedbackBox.style.display = "none";
        updateChipSelectionFromState();
      });
    });

    function capitalize(str) {
      return str.charAt(0).toUpperCase() + str.slice(1);
    }

    // -----------------------------
    // Helpers to get selections
    // -----------------------------
    function getChosenTagsForMeal(meal) {
      const result = [];
      for (const [category, set] of Object.entries(selections[meal])) {
        set.forEach(id => result.push(id));
      }
      return result;
    }

    function getPresentKeyGroupsForMeal(meal) {
      const present = [];
      KEY_GROUPS.forEach(cat => {
        if (selections[meal][cat].size > 0) present.push(cat);
      });
      return present;
    }

    // -----------------------------
    // Recipes: filtering and rendering
    // -----------------------------
    function showRecipesForCurrentMeal() {
      const chosenTags = getChosenTagsForMeal(currentMeal);
      const chosenCuisine = cuisineSelect.value;

      // Filter recipes
      const filtered = recipes.filter(r => {
        // Check meal
        if (!r.meals.includes(currentMeal)) return false;
        // Check cuisine
        if (chosenCuisine !== "any" && r.cuisine !== chosenCuisine) return false;
        // If no choices selected, allow all matching meal+cuisine
        if (!chosenTags.length) return true;
        // Require at least one overlapping ingredient
        return chosenTags.some(t => r.tags.includes(t));
      });

      const reasonText = chosenTags.length
        ? "Matches some of your chosen foods: " + chosenTags.join(", ")
        : "Based on your selected meal and cuisine.";

      renderRecipeList(filtered, reasonText);
    }

    function renderRecipeList(list, reasonText) {
      recipesContainer.innerHTML = "";
      if (!list.length) {
        recipesContainer.innerHTML = `
          <div class="empty-state">
            <strong>No recipes found yet‚Ä¶</strong>
            Try choosing fewer items or a different cuisine. You can also mix fruits, veggies, protein and carbs for more ideas.
          </div>
        `;
        recipeCountLabel.textContent = "0 recipes";
        return;
      }

      recipeCountLabel.textContent = list.length + (list.length === 1 ? " recipe" : " recipes");

      list.forEach(r => {
        const card = document.createElement("article");
        card.className = "recipe-card";
        const tagHtml = r.tags.map(t => `<span>${t}</span>`).join(" ");
        const ingredientsHtml = r.ingredients.map(i => `<li>${i}</li>`).join("");
        const stepsHtml = r.steps.map(s => `<li>${s}</li>`).join("");

        card.innerHTML = `
          <div class="recipe-title-row">
            <h3>${r.name}</h3>
            <span class="cuisine-tag">${r.cuisine}</span>
          </div>
          <div class="recipe-tags">${tagHtml}</div>
          <div class="recipe-section-title">Ingredients:</div>
          <ul>${ingredientsHtml}</ul>
          <div class="recipe-section-title">Steps:</div>
          <ol>${stepsHtml}</ol>
          <div class="recipe-footer">
            <strong>Why it‚Äôs good:</strong> ${r.healthNote}<br>
            <strong>Match:</strong> ${reasonText}
          </div>
        `;
        recipesContainer.appendChild(card);
      });
    }

    // -----------------------------
    // Balance checking & points
    // -----------------------------
    function checkBalanceForCurrentMeal() {
      const presentGroups = getPresentKeyGroupsForMeal(currentMeal);
      const missing = KEY_GROUPS.filter(cat => !presentGroups.includes(cat));

      if (presentGroups.length === 0) {
        showMealFeedback("Try adding some foods first. Pick at least one fruit, one veg, one protein or carb.", "bad");
        return;
      }

      if (missing.length === 0) {
        // Perfectly balanced
        let message = `üéâ Great job! Your ${currentMeal} has <strong>fruit</strong>, <strong>vegetables</strong>, <strong>protein</strong> and <strong>carbs</strong>. That is a balanced meal. You earn <strong>10 points</strong>!`;
        showMealFeedback(message, "good");
        awardPointsForMeal(currentMeal);
      } else {
        const friendlyNames = {
          fruit: "fruit",
          veg: "vegetables",
          protein: "protein",
          carb: "carbs / grains"
        };
        const missingText = missing.map(m => friendlyNames[m]).join(", ");
        let message = `‚ö†Ô∏è Your ${currentMeal} is almost there, but missing: <strong>${missingText}</strong>.<br>Try adding one item from each missing group to make it balanced.`;
        showMealFeedback(message, "bad");
      }

      // Update progress bar whenever we check balance
      updateProgressBar();
    }

    function showMealFeedback(html, type) {
      mealFeedbackBox.innerHTML = html;
      mealFeedbackBox.classList.remove("good", "bad");
      if (type === "good") mealFeedbackBox.classList.add("good");
      if (type === "bad") mealFeedbackBox.classList.add("bad");
      mealFeedbackBox.style.display = "block";
    }

    function awardPointsForMeal(meal) {
      if (balanceAwarded[meal]) return; // Avoid double points for same meal
      balanceAwarded[meal] = true;
      points += 10;
      updatePointsDisplay();
    }

    function updatePointsDisplay() {
      pointsValue.textContent = points;
      pointsValue.classList.remove("pop");
      void pointsValue.offsetWidth; // trigger reflow for animation restart
      pointsValue.classList.add("pop");
    }

    // -----------------------------
    // Progress bar (balanced meals)
    // -----------------------------
    function updateProgressBar() {
      let balancedCount = 0;
      meals.forEach(meal => {
        const present = getPresentKeyGroupsForMeal(meal);
        if (KEY_GROUPS.every(cat => present.includes(cat))) {
          balancedCount++;
        }
      });
      const percent = (balancedCount / 3) * 100;
      progressFill.style.width = percent + "%";
      progressLabel.textContent = `Balanced meals today: ${balancedCount} of 3`;
    }

    // -----------------------------
    // Clear meal selections
    // -----------------------------
    function clearCurrentMeal() {
      for (const cat of Object.keys(selections[currentMeal])) {
        selections[currentMeal][cat].clear();
      }
      updateChipSelectionFromState();
      mealFeedbackBox.style.display = "none";
      updateProgressBar();
    }

    // -----------------------------
    // Day summary
    // -----------------------------
    function checkDaySummary() {
      daySummaryList.innerHTML = "";
      meals.forEach(meal => {
        const li = document.createElement("li");
        const present = getPresentKeyGroupsForMeal(meal);
        const missing = KEY_GROUPS.filter(cat => !present.includes(cat));
        let text = `${capitalize(meal)}: `;

        if (present.length === 0) {
          text += "No foods selected yet.";
          li.innerHTML = text + ` <span class="badge">Add foods</span>`;
        } else if (missing.length === 0) {
          text += "Balanced meal (has fruit, veg, protein & carbs).";
          li.innerHTML = `‚úÖ ${text} <span class="badge">Great!</span>`;
        } else {
          const friendlyNames = {
            fruit: "fruit",
            veg: "vegetables",
            protein: "protein",
            carb: "carbs"
          };
          const missingText = missing.map(m => friendlyNames[m]).join(", ");
          text += `Missing: ${missingText}.`;
          li.innerHTML = `‚ö†Ô∏è ${text} <span class="badge">Can improve</span>`;
        }

        daySummaryList.appendChild(li);
      });

      updateProgressBar();
    }

    // -----------------------------
    // "Did you know?" facts
    // -----------------------------
    function showRandomFact() {
      const index = Math.floor(Math.random() * nutritionFacts.length);
      didYouKnowText.textContent = nutritionFacts[index];
    }

    // -----------------------------
    // Event listeners
    // -----------------------------
    showRecipesBtn.addEventListener("click", showRecipesForCurrentMeal);
    checkBalanceBtn.addEventListener("click", checkBalanceForCurrentMeal);
    clearMealBtn.addEventListener("click", clearCurrentMeal);
    checkDayBtn.addEventListener("click", checkDaySummary);
    newFactBtn.addEventListener("click", showRandomFact);

    // Initial render
    renderChips();
    showRandomFact();
    updateProgressBar();
  </script>
</body>
</html>